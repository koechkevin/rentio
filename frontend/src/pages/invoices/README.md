# Invoice Frontend Components

This directory contains the React components for the invoice management system.

## Components

### 1. InvoiceList.tsx

A comprehensive invoice list view with:

- Pagination
- Filtering by status
- View, Edit, and Delete actions
- Color-coded status chips
- Responsive table layout
- Currency formatting

**Route**: `/invoices`

### 2. CreateInvoiceForm.tsx

An invoice creation form that includes:

- Customer selection (from active leases)
- Unit selection (auto-populates rent)
- Dynamic invoice items table
- Automatic rent addition when unit is selected
- Duplicate billing check (warns if item already invoiced for the period)
- Real-time total calculation with VAT
- Validation and error handling

**Route**: `/invoices/create`

**Key Features**:

- Automatically suggests rent item when unit is selected
- Checks if an item has already been invoiced for the selected period
- Shows warnings for duplicate billing attempts
- Calculates subtotal, VAT, and total in real-time

### 3. InvoiceDetail.tsx

A detailed invoice view with:

- Complete invoice information display
- Customer and property details
- Itemized breakdown
- Status display with color coding
- PDF download functionality
- Professional PDF generation with company branding

**Route**: `/invoices/:id`

**PDF Features**:

- Professional layout
- Company header
- Itemized list with descriptions
- Totals section
- Notes section
- Footer with generated by information

## Installation

### Required Dependencies

```bash
npm install jspdf @mui/x-date-pickers
```

or

```bash
yarn add jspdf @mui/x-date-pickers
```

### Peer Dependencies (if not already installed)

```bash
npm install @mui/material @emotion/react @emotion/styled @mui/icons-material react-router-dom
```

## Setup

### 1. Add Routes to Your Router

```typescript
// In your router file (e.g., App.tsx or routes/index.tsx)
import InvoiceList from './pages/invoices/InvoiceList';
import CreateInvoiceForm from './pages/invoices/CreateInvoiceForm';
import InvoiceDetail from './pages/invoices/InvoiceDetail';

// Add to your routes
<Route path="/invoices" element={<InvoiceList />} />
<Route path="/invoices/create" element={<CreateInvoiceForm />} />
<Route path="/invoices/:id" element={<InvoiceDetail />} />
<Route path="/invoices/:id/edit" element={<CreateInvoiceForm />} /> // Reuse form for edit
```

### 2. Configure API Base URL

Make sure your `config/api.ts` is configured correctly:

```typescript
import axios from 'axios';

const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:3000/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

// Add authorization header
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;
```

### 3. Add Menu Items

Add invoice links to your navigation menu:

```typescript
// In your menu configuration
{
  title: 'Invoices',
  icon: <ReceiptIcon />,
  path: '/invoices',
  roles: ['OWNER', 'CARETAKER'],
},
{
  title: 'My Invoices',
  icon: <ReceiptIcon />,
  path: '/invoices/my-invoices', // For tenants
  roles: ['TENANT'],
}
```

## Usage Examples

### Creating an Invoice

1. Navigate to `/invoices/create`
2. Select a customer (tenant)
3. Select a unit (rent is automatically added)
4. Add additional items (water, electricity, etc.)
5. Set due date and VAT rate
6. Add optional notes
7. Click "Create Invoice"

### Viewing Invoices

1. Navigate to `/invoices`
2. Use filters to narrow down invoices
3. Click the eye icon to view details
4. Click the download icon to generate PDF

### Downloading Invoice as PDF

1. Navigate to an invoice detail page
2. Click "Download PDF" button
3. PDF will be generated and downloaded automatically

## Customization

### PDF Styling

You can customize the PDF layout in `InvoiceDetail.tsx`:

```typescript
const generatePDF = () => {
  // Modify fonts, colors, layout, etc.
  doc.setFontSize(24);
  doc.setTextColor(0, 0, 0);
  // Add your company logo
  // doc.addImage(logoData, 'PNG', x, y, width, height);
};
```

### Invoice Status Colors

Modify the `getStatusColor` function to change status chip colors:

```typescript
const getStatusColor = (status: string) => {
  switch (status) {
    case 'PAID':
      return 'success'; // Green
    case 'OVERDUE':
      return 'error'; // Red
    // Add custom colors
    default:
      return 'default';
  }
};
```

### Currency Formatting

Change the currency format in the `formatCurrency` function:

```typescript
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD', // Change to your currency
  }).format(amount);
};
```

## API Integration

These components integrate with the following backend endpoints:

- `GET /api/invoices` - Get all invoices (with pagination and filters)
- `POST /api/invoices` - Create a new invoice
- `GET /api/invoices/:id` - Get invoice details
- `PUT /api/invoices/:id` - Update an invoice
- `DELETE /api/invoices/:id` - Delete an invoice
- `GET /api/invoices/check/item-invoiced` - Check if item already invoiced
- `GET /api/invoices/suggested-items/:unitId` - Get suggested items (including rent)
- `GET /api/invoices/my-invoices` - Get customer's own invoices (for tenants)

## Features

### For Property Owners/Caretakers:

- ✅ Create invoices for tenants
- ✅ View all property invoices
- ✅ Edit draft invoices
- ✅ Delete unpaid invoices
- ✅ Download invoices as PDF
- ✅ Auto-populate rent from lease/unit
- ✅ Check for duplicate billing
- ✅ Filter by status, customer, unit

### For Tenants:

- ✅ View their own invoices
- ✅ Download invoices as PDF
- ✅ See payment status
- ✅ View itemized breakdown

## Best Practices

1. **Always check for duplicate billing**: The form automatically checks if an item has been invoiced for the selected period
2. **Use proper billing periods**: Set the `billingPeriod` to the first day of the month for monthly items
3. **Add descriptive notes**: Help tenants understand what they're being charged for
4. **Update invoice status**: Change status from DRAFT to SENT when you send to the tenant
5. **Generate PDFs before emailing**: Download and attach PDFs to emails sent to tenants

## Troubleshooting

### Invoice not loading

- Check that the API endpoint is correct
- Verify authentication token is valid
- Check browser console for errors

### PDF not generating

- Ensure `jspdf` is installed
- Check that invoice data is fully loaded before generating PDF
- Verify no console errors during PDF generation

### Duplicate billing warnings not showing

- Check that `propertyId` is being passed correctly
- Verify the API endpoint for checking duplicates is working
- Ensure `billingPeriod` is set correctly

## Future Enhancements

- [ ] Email invoice directly from the UI
- [ ] Recurring invoice templates
- [ ] Bulk invoice generation
- [ ] Payment tracking integration
- [ ] Invoice analytics dashboard
- [ ] Custom invoice templates
- [ ] Multi-language support
- [ ] Invoice reminders

## Support

For issues or questions, refer to the main project documentation or contact the development team.
